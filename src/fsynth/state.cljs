(ns fsynth.state
  (:require
   [reagent.core :as reagent]))

(defn init-notes []
  (into [] (take 17 (repeatedly #(rand-int 2)))))

(defn blank-notes []
  "Sets all notes to 0"
  (let [keys (map (fn [n] (keyword (str n))) (range 1 17))
        vals (into [] (take 16 (repeatedly #(rand-int 0))))]
    (zipmap keys (repeat 16 vals))))

(def note-rows1
  {:1  [1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0]
   :2  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :3  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :4  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :5  [0 0 1 0 0 0 1 0 0 0 1 0 0 0 0 0]
   :6  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :7  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0]
   :8  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :9  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :10 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :11 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :12 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :13 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :14 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :15 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :16 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]})

(def note-rows2
  {:1  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :2  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :3  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :4  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :5  [0 0 1 1 0 0 1 1 0 0 1 1 0 0 1 1]
   :6  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :7  [0 0 1 0 0 0 1 0 0 0 0 1 0 0 1 0]
   :8  [0 0 0 1 0 0 0 1 0 0 1 0 0 0 0 0]
   :9  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1]
   :10 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :11 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :12 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :13 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :14 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :15 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :16 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]})

(def note-rows3
  {:1  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :2  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :3  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :4  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :5  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :6  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :7  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :8  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :9  [0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :10 [0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :11 [0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0]
   :12 [0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0]
   :13 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :14 [0 0 0 0 0 0 0 0 0 0 1 0 0 1 0 0]
   :15 [1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :16 [0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0]})

(def note-rows4
  {:1  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :2  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :3  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :4  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :5  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :6  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :7  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :8  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :9  [0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0]
   :10 [1 0 1 0 0 0 1 0 0 1 0 0 0 0 0 0]
   :11 [0 1 0 0 0 0 0 1 1 0 0 0 0 0 0 0]
   :12 [0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0]
   :13 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   :14 [0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0]
   :15 [0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0]
   :16 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]})

(def state1
  (reagent/atom
   {;:wave     "sawtooth"
    :color    "#3286aa"
    :playing? false
    :zoom?    false 
    :notes    note-rows1}))

(def state2
  (reagent/atom
   {;:wave     "square"
    :color    "deeppink"
    :playing? false
    :zoom?    false
    :notes    note-rows2}))

(def state3
  (reagent/atom
   {;:wave     "sawtooth"
    :color    "teal"
    :playing? false
    :zoom?    false
    :notes    note-rows3}))

(def state4
  (reagent/atom
   {;:wave     "triangle"
    :color    "#bbb"
    :playing? false
    :zoom?    false
    :notes    note-rows4}))

(def global-state
  (reagent/atom
   {:playing?            false
    :mode                :aeolian
    :wave                "sawtooth"
    :index               1
    :tempo               300
    :lookahead           1000
    :schedule-ahead-time 0.1
    :next-note-time      0.0
    :all-states
  [state1 state2 state3 state4]}))


